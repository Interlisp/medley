(DEFINE-FILE-INFO PACKAGE "INTERLISP" READTABLE "INTERLISP" BASE 10)(FILECREATED " 3-Mar-2002 22:47:25" {DSK}<project>medley3.5>current>PARC-INIT.;21 42271        changes to%:  (FNS ParcInit)      previous date%: "14-Feb-2002 09:12:08" {DSK}<project>medley3.5>current>PARC-INIT.;20)(* ; "Copyright (c) 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2002 by Xerox Corporation.  All rights reserved.")(PRETTYCOMPRINT PARC-INITCOMS)(RPAQQ PARC-INITCOMS       [        (* ;; "PARC/SSL, and IRL  system greeting file")        (DECLARE%: FIRST (P                                  (* ; "Patch for SOLARIS at DDS??")                            (CL:INTERN "*YP-DOMAIN*" "YP")))        (FNS PARC-INIT FindSite FindInitHost ParcInit SetDirectories LoadPatches COLLECT-PATCH-FILES             INTERLISPMODE FILE-SERVER-UP-P HostPrefix)        (FNS SUNOSNAME)        (FUNCTIONS WITHOUT.PAGEHOLD)                (* ;;       "Initially set LOCALPATCHDIRECTORY to NIL to avoid loading patches if no servers are up.")        (VARS (LOCALPATCHDIRECTORY NIL))        (VARS (*USEOLDFONTDIRECTORIES* NIL))        (INITVARS (UNIXMAIL.DOMAIN.NAME "parc.com"))        (INITVARS (INIT-NOGREET-FLAG NIL))        (DECLARE%: DONTEVAL@LOAD DOCOPY (P (PARC-INIT)))        (DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDVARS (NLAMA)                                                                             (NLAML)                                                                             (LAMA])(* ;; "PARC/SSL, and IRL  system greeting file")(DECLARE%: FIRST                                                              (* ; "Patch for SOLARIS at DDS??")(CL:INTERN "*YP-DOMAIN*" "YP"))(DEFINEQ(PARC-INIT
  [LAMBDA NIL
    (DECLARE (GLOBALVARS \INIT.HostName MAKESYSNAME LOCALPATCHDIRECTORY MAKESYSDATE 
                        AUTHENTICATION.NET.HINT CH.NET.HINT NSMAIL.NET.HINT))
                                                             (* ; "Edited 11-Mar-99 17:46 by rmk:")
                                                             (* ; 
                                                           "Edited  7-Mar-99 01:56 by kaplan")
                                                             (* ; "Edited 30-Jan-92 16:26 by bbb")

    (* ;; "This is what gets called when PARC-INIT is loaded.")

    (IF (EQ 'MAIKO (MACHINETYPE))
        THEN (SETQ INIT-NOGREET-FLAG (UNIX-GETENV "NOGREET")))
    (LOGIN NIL 'QUIET)
    (BKSYSBUF " ")
    (AND (GETD 'MEDLEYVERSION)
         (SELECTQ (MEDLEYVERSION)
             (|2.0|                                          (* ; 
       "Make sure that the compile extensions are set right, in case they reverted to LCOM, DFASL.")
                    (SETQ COMPILE.EXT 'MCOM)
                    (SETQ FASL.EXT 'MFASL)
                    (SETQ *COMPILED-EXTENSIONS* '(MCOM MFASL)))
             NIL))

    (* ;; "do the real work")

    (WITHOUT.PAGEHOLD (WFROMDS (GETSTREAM T 'OUTPUT))
           (FindSite)
           (SETQ YP:*YP-DOMAIN* (IF (EQ \INIT.Location 'ADOC)
                                    THEN "ADOC"
                                  ELSE "PARC"))

           (* ;; "1st floor = 132 204#")

           (* ;; "2nd floor = 89 131#")

           (* ;; "3rd floor = 98  142#")

           (* ;; "Bldg 34 = 106 152#")

           (* ;; "The clearinghouses in Building 35 are on net 132 (two of them), 89 and 98")

           (* ;; "In Building 34 on net 152 and net 146 in building 32")

(* ;;; " hmmm this is strange.. I don't see net 146... I took 146 out")

           (SAVESET 'AUTHENTICATION.NET.HINT (SAVESET 'CH.NET.HINT
                                                    (SELECTQ \INIT.Location
                                                        (ENVOS-MTNVIEW (LIST 138))
                                                        (IRL-HANOVER (LIST 132 89 98 152))
                                                        (BLDG34-10MB (LIST 106 132 89 98))
                                                        (BLDG35-1STFLOOR 
                                                             (LIST 132 89 98 106))
                                                        (BLDG35-2NDFLOOR 
                                                             (LIST 89 132 98 106))
                                                        (BLDG35-3RDFLOOR 
                                                             (LIST 98 132 89 106))
                                                        (ADOC (LIST 132 89 98 106))
                                                        (LIST 132 89 98 106))
                                                    T)
                  T)

           (* ;; " there are mail servers in Building 35 are on nets 89, 98 and 132")

           (SAVESET 'NSMAIL.NET.HINT (SELECTQ \INIT.Location
                                         ((IRL-HANOVER BLDG34-10MB) 
                                              (LIST 89))
                                         AUTHENTICATION.NET.HINT)
                  T)
           (FindInitHost)
           (ParcInit)
           (CL:WHEN INIT-NOGREET-FLAG
               (SAVESET 'USERGREETFILES NIL T))
           (CL:WHEN LOCALPATCHDIRECTORY
               (LoadPatches LOCALPATCHDIRECTORY 'SYSLOAD MAKESYSDATE))])(FindSite
  [LAMBDA NIL                                            (* ; "Edited 14-Oct-97 18:38 by rmk:")
                                                           (* ; "Edited  8-Dec-89 19:46 by Burwell")
    (DECLARE (GLOBALVARS \INIT.Location \MY.NSADDRESS \LOCALPUPNETHOST))

(* ;;; "Determine location, for use by other init we have to handle nets 6 and 64 specially since they cover 2 floors.  We also have to use etherhostnumbers rather than names, since the name service doesn't appear to work reliably on Dorados (nhb ' 5-Dec-85 11:36:13') Still seeing wrong location occasionally, keep the etherhostnumber for later diagnosis.  (nhb '13-Jan-86 20:23:47') problem seems to be that system returns hostnumber with 0 net number, we'll dismiss until it's greater than 255 (nhb '16-Jan-86 10:57:46') Added net 273## for Sunnyvale (nhb ' 9-Feb-88 15:54:17') Edited to reflect move of XAIS to Envos in Mtn.  View, and IRL to the Garage (bbb 1-sep-88)")

(* ;;; "")

(* ;;; "27-Mar-89 bbb added home dialin lines")

(* ;;; "13-Sep-89 bvm changed to look at XNS net instead of Pup")

    (SAVESET '\INIT.Location
           (SELECTQ (CL:WHEN (STREQUAL "1" (UNIX-GETENV "LDELISPXNS"))
                        (FOR Delay IN '(20 55 148 403 1096)
                           DO (IF (AND \MY.NSADDRESS (> (SETQ $$VAL (\GETBASEFIXP 
                                                                                   \MY.NSADDRESS 0))
                                                                0))
                                      THEN               (* ; "Find my XNS net number")
                                            (RETURN $$VAL))
                                 (DISMISS Delay) FINALLY (PRINTOUT T 
                                                "* Warning: Init could not determine your net number"
                                                                    T 
                                                   "           assuming location is Bldg35-2nd floor"
                                                                    T)
                                                       (RETURN 6)))
               (98 'BLDG35-3RDFLOOR)
               (89 'BLDG35-2NDFLOOR)
               (3 'PARC-NET3)
               (17778 'ADOC)
               ((52 6 132) 
                    'BLDG35-1STFLOOR)
               (106 'BLDG34-10MB)
               ((7 138) 
                    'ENVOS-MTNVIEW)
               ((146 21) 
                    'IRL-HANOVER)
               ((159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175) 
                    'HOME-DIALIN)
               (* ; "Home DIAL-IN 237Q through 257Q")
               (OR (MKATOM (UNIX-GETENV "LDESITE"))
                   'BLDG35-2NDFLOOR])(FindInitHost
  [LAMBDA NIL
    (DECLARE (GLOBALVARS \INIT.HostName \INIT.AlternateHostNames \INIT.Location))
                                                             (* ; "Edited 27-Oct-93 14:56 by rmk:")

(* ;;; "Lyric PARC people who have NS id's will have all their directories set to IE:PARC:Xerox")

(* ;;; "")

(* ;;; "July 28, 1989")

(* ;;; "Medley is on Phylum, ie and Erinyes.  PARC people with NS ids will randomly get assigned to either Pooh or ie:parc:xerox.  IRL people will point to ie:parc:xerox")

(* ;;; "We need to set the default domain and organization before we do a clearinghouse lookup")

(* ;;; "")

(* ;;; "October 6, 1989")

(* ;;; 
" PARC people will have their directories set only to pooh (not randomly on ie:parc:xerox or pooh)")

(* ;;; "")

(* ;;; "October 3, 1990")

(* ;;; "Take out all references to Phylum")

(* ;;; "")

(* ;;; "January 30, 1992")

(* ;;; " Replace references to {pooh/n}<pooh>lisp> with {dsk}/import/lisp")

(* ;;; "")

    (SAVESET 'CH.DEFAULT.DOMAIN "PARC" T)
    (SAVESET 'CH.DEFAULT.ORGANIZATION "Xerox" T)
    (SAVESET 'YP:*YP-DOMAIN* (IF (EQ \INIT.Location 'ADOC)
                                 THEN "ADOC"
                               ELSE "PARC")
           T)
    (LET (HasNSID? MsgWindowMenu MsgWindow)
         (SELECTQ (MKATOM (U-CASE (MKSTRING MAKESYSNAME)))
             (MEDLEY2.0 [PROGN (SELECTQ \INIT.Location
                                   ((IRL-HANOVER) 
                                                  (* ;; "IRL and home dial-in can't talk tcp/ip ")

                                        (SAVESET '\INIT.HostName "IE:PARC:XEROX")
                                        (SAVESET '\INIT.AlternateHostNames NIL))
                                   (PROGN (SAVESET '\INIT.HostName "{dsk}<import>medley2.0>")
                                          (SAVESET '\INIT.AlternateHostNames '("IE:PARC:Xerox"])
             (MEDLEY [PROGN (SELECTQ \INIT.Location
                                ((IRL-HANOVER) 
                                               (* ;; "IRL and home dial-in can't talk tcp/ip ")

                                     (SAVESET '\INIT.HostName "IE:PARC:XEROX")
                                     (SAVESET '\INIT.AlternateHostNames '("Erinyes")))
                                (PROGN (SAVESET '\INIT.HostName "{dsk}<import>")
                                       (SAVESET '\INIT.AlternateHostNames '("IE:PARC:Xerox"])
             (PROGN (SAVESET '\INIT.HostName "{dsk}<import>")
                    (SAVESET '\INIT.AlternateHostNames '("IE:PARC:Xerox"])(ParcInit  [LAMBDA NIL                                                (* ;                                                            "Edited  4-Jan-2002 17:45 by kaplan")                                                             (* ;                                                            "Edited  4-Jan-2002 17:45 by kaplan")                                                             (* ;                                                            "Edited  3-Mar-2002 22:47 by rmk:")                                                             (* "N.H.Briggs" " 2-Nov-87 12:39")                                                             (* bbb "29-Oct-87 17:17")    (DECLARE (GLOBALVARS \INIT.Location \INIT.HostName \INIT.AlternateHostNames MAKESYSNAME                         POSTGREETFORMS DEFAULTREGISTRY CH.DEFAULT.ORGANIZATION CH.DEFAULT.DOMAIN                         YP:*YP-DOMAIN* AUTHENTICATION.NET.HINT CH.NET.HINT PRINTSERVICE                         DEFAULTPRINTINGHOST DEFAULTFAXHOST FAXADDRESSES NETWORKLOGINFO LISPSUPPORT                         LAFITESUPPORT TEDITSUPPORT NETWORKOSTYPES LAFITESPECIALFORMS LAFITEFORMSMENU                        LAFITEFORMDIRECTORIES LAFITEMODEDEFAULT PHONELISTFILES BackgroundMenu                         BackgroundMenuCommands USERGREETFILES COPYRIGHTFLG COPYRIGHTOWNERS                         DEFAULTCOPYRIGHTOWNER COPYRIGHTRESERVED SYSOUTFETCHDATE \CURRENTDISPLAYLINE                         IMAGESTREAMTYPES RECLAIMWAIT LOCALPATCHDIRECTORY CHAT.HOSTINFO EMPRESS#SIDES                        \INIT.MachineType NFS:*USE-VOLUME-MAP*)           (SPECVARS LDFLG))    (PROG (LispusersUpdateHostName FontHostName ReleaseName)          (IF (NOT (BOUNDP 'SYSOUTFETCHDATE))              THEN (SETQ SYSOUTFETCHDATE (DATE)))          [SETQ ReleaseName (MKATOM (U-CASE (MKSTRING MAKESYSNAME](* ;;; "Prevent a pagehold from happening")          (SETQ \CURRENTDISPLAYLINE -10000)(* ;;; "Do not put any patch-type code before this point.  This code will get executed once before the init file realizes that it needs to be updated.  Once it updates the init file it will execute the code again up to this point.")          (SETQ \INIT.MachineType (MACHINETYPE))          (ADDTOVAR GREETDATES (" 8-MAR" . "It's International Women's Day")                                   ("18-MAY" . "It's Victoria Day")                                   (" 5-NOV" . "<boom> it's Guy Fawkes day")                                   (" 1-JUL" . "It's Canada Day")                                   ("12-OCT" . "It's Canada's Thanksgiving Day"))          (SAVESET 'USERGREETFILES (LET [[NFSFiles '(({dsk}<tilde> USER >LISP>INIT. COM)                                                     ({dsk}<tilde> USER >LISP>INIT)                                                     ({dsk}<tilde> USER >INIT. COM)                                                     ({dsk}<tilde> USER >INIT.LISP]                                         (LocalFiles '(({DSK}INIT- USER %. COM)                                                       ({DSK}INIT- USER]                                        (APPEND NFSFiles LocalFiles))                 T)     (* ;; "things to do with the copyright notices in files")          (SAVESET 'COPYRIGHTFLG 'DEFAULT T)          (SAVESET 'COPYRIGHTOWNERS '((PARC "Palo Alto Research Center Incorporated")                                      (XEROX "Xerox Corporation")                                      (VENUE "Venue Corporation"))                 T)          (COND             ((FMEMB \INIT.Location '(ENVOS-MTNVIEW))              (SAVESET 'DEFAULTCOPYRIGHTOWNER 'VENUE T))             (T (SAVESET 'DEFAULTCOPYRIGHTOWNER 'PARC T)))          (SAVESET 'COPYRIGHTRESERVED T T)     (* ;; "the interpress printers at PARC are all running print services 9.0 or higher now.")          (SAVESET 'PRINTSERVICE 10.0 T)     (* ;; "Setup docuprint printers at PARC")          (SELECTQ \INIT.Location              ((BLDG35-3RDFLOOR BLDG35-1STFLOOR BLDG35-2NDFLOOR PARC-NET3)                    (SETQ EMPRESS#SIDES 2)                   (FOR P IN '(|Waterman:PARC:xerox| |Mont Blanc:PARC:xerox|                                              |Perfector:PARC:Xerox| |Ansel:PARC:xerox|                                              |Kanji:PARC:xerox| |Squeeze-Box:PARC:xerox|                                              |Papaya:Parc:Xerox|) DO (PUT P 'PRINTERTYPE                                                                              'DOCUPRINT)))              NIL)     (* ;; "Select an appropriate set of printers based on the location.")          (SAVESET 'DEFAULTPRINTINGHOST                 (COPY (SELECTQ \INIT.Location                           (BLDG35-1STFLOOR                                 '(|Mont Blanc:PARC:xerox| londondailymail |Marker:PARC:Xerox|))                           (BLDG35-2NDFLOOR                                 (APPEND '(comicnews)                                       [FOR X                                          IN '(|Waterman:PARC:xerox| |Mont Blanc:PARC:xerox|                                                          |Perfector:PARC:Xerox| |Ansel:PARC:xerox|                                                          |Kanji:PARC:xerox| |Squeeze-Box:PARC:xerox|                                                         |Papaya:Parc:Xerox|)                                          JOIN `((DOCUPRINT ,X INTERPRESS)                                                     (DOCUPRINT ,X POSTSCRIPT]                                       (FOR X IN '(|Marker:PARC:Xerox|) COLLECT X)                                       '(londondailymail)))                           (BLDG35-3RDFLOOR                                 '(|Papermate:Parc:Xerox|))                           (BLDG34-10MB '(|Cross:parc:Xerox| |Kanji:PARC:Xerox|))                           (PARC-NET3 '(|Scripto:PARC:Xerox| |Perfector:PARC:Xerox|))                           NIL))                 T)     (* ;; "set things related to the Interpress to FAX service")          (SAVESET 'DEFAULTFAXHOST "VPFax:Parc:XEROX" T)          (ADDTOVAR FAXADDRESSES (NLTT/FAX 94154944374)                                     (POD26/FAX 94154944380)                                     (EUROPARC/FAX 901144223341510)                                     (MICROLYTICS/FAX 97162483868))          (SETQ LispusersUpdateHostName NIL)          (SETQ FontHostName (SELECTQ ReleaseName                                 ((MEDLEY2.0 MEDLEY2.1)                                       "{dsk}<import>")                                 \INIT.HostName))          (IF \INIT.HostName              THEN (SetDirectories \INIT.HostName LispusersUpdateHostName NIL FontHostName                               NIL T))     (* ;; "fix up the Unix login method to deal with brain damaged ParcVax")          [AND (LISTP (GETTOPVAL 'NETWORKLOGINFO))               (/RPLACD (ASSOC 'LOGIN (CDR (ASSOC 'UNIX NETWORKLOGINFO)))                      '(WAIT LF WAIT USERNAME LF WAIT PASSWORD LF))               (/RPLACD (ASSOC 'LOGIN (CDR (ASSOC 'NS NETWORKLOGINFO)))                      '("Logon" CR USERNAME CR PASSWORD CR](* ;;; "use to have (ADDTOVAR LAFITESUPPORT ...) but that produced the wrong result for already initialized variables")          (SELECTQ ReleaseName              ((MEDLEY MEDLEY2.0 MEDLEY2.1)                    [SETQ LISPSUPPORT '((NS                                         "AISupport:MV:Envos, Burwell:PARC:Xerox, vanMelle:PARC:Xerox"                                           ]                   [SETQ LAFITESUPPORT '((NS "LafiteSupport:PARC:Xerox"]                   (SETQ TEDITSUPPORT LISPSUPPORT))              NIL)     (* ;; "make sure we know about some of the local machine types")          (ADDTOVAR NETWORKLOGINFO (INFOVAX (LOGIN "User" CR)))          (ADDTOVAR NETWORKOSTYPES (XSVAX . VMS)                                       (MADVAX . VMS)                                       (INFOVAX%: . INFOVAX)                                       (|INFOVAX:PARC:XEROX| . INFOVAX)                                       (FLO . UNIX)                                       (POOH . UNIX)                                       (PIGLET . UNIX)                                       (PALAIN . UNIX)                                       (KANGA . UNIX)                                       (ROO . UNIX)                                       (ROO%: . UNIX)                                       (|ROO:PARC:XEROX| . UNIX)                                       (FREDDYK . UNIX))     (* ;; "Set up the hint to Lafite for finding form files for the PARC archiving")          (SELECTQ \INIT.Location              ((BLDG35-1STFLOOR BLDG35-2NDFLOOR BLDG35-3RDFLOOR)                    (SETQ LAFITEFORMSMENU NIL))              ((IRL-HANOVER)                    (SETQ LAFITEFORMSMENU NIL))              NIL)          (SETQ LAFITEMODEDEFAULT 'NS)     (* ;; "pointer to the PARC phone list file")          (ADDTOVAR PHONELISTFILES {dsk}<import>doc>parcphonelist.txt                                              {dsk}<import>doc>ssutelephonelist.txt)     (* ;; "Set the default IDLE options for PARC, a friendly place")          (IDLE.SET.OPTION 'FORGET NIL)          (/PUTPROP 'NSMAINTAIN 'FILEDEF 'NSMAINTAIN)          (IF [AND (NOT (ASSOC 'Set% Directories BackgroundMenuCommands))                       (MEMB ReleaseName '(MEDLEY MEDLEY2.0 MEDLEY2.1]              THEN (/NCONC1 BackgroundMenuCommands                              (LIST 'Set% Directories '(SetDirectories)                                    "Set search path and font directories to default"                                    (SELECTQ ReleaseName                                        ((MEDLEY MEDLEY2.0 MEDLEY2.1)                                              '(SUBITEMS (NFS '(SetDirectories "{dsk}<import>" NIL                                                                     NIL NIL NIL T)                                                                                                                 "Set search patch and font directories to Import"                                                             )))                                        NIL)))                    (SETQ BackgroundMenu NIL))          [COND             ((FMEMB \INIT.Location '(ENVOS-MTNVIEW))              (IF (MEMB ReleaseName '(MEDLEY MEDLEY2.0 MEDLEY2.1))                  THEN (SAVESET 'XCL:*SHORT-SITE-NAME* 'Venue T)                        (SAVESET 'XCL:*LONG-SITE-NAME* "Venue Corporation, San Carlos" T)))             (T (IF (MEMB ReleaseName '(MEDLEY MEDLEY2.0 MEDLEY2.1))                    THEN (SAVESET 'XCL:*SHORT-SITE-NAME* "PARC" T)                          (SAVESET 'XCL:*LONG-SITE-NAME* "Xerox Palo Alto Research Center" T](* ;;; "We are decommissioning the volume map so tell Lisp not to use it")          (SAVESET 'NFS:*USE-VOLUME-MAP* NIL)          (FOR VAR             IN '(AUTHENTICATION.NET.HINT BackgroundMenu BackgroundMenuCommands CH.DEFAULT.DOMAIN                            YP:*YP-DOMAIN* CH.DEFAULT.ORGANIZATION CH.NET.HINT NSMAIL.NET.HINT                             COPYRIGHTFLG COPYRIGHTOWNERS COPYRIGHTRESERVED DEFAULTCOPYRIGHTOWNER                             DEFAULTFAXHOST DEFAULTPRINTINGHOST DEFAULTREGISTRY FAXADDRESSES                             GREETDATES LAFITEFORMDIRECTORIES LAFITEFORMSMENU LAFITESPECIALFORMS                             LAFITESUPPORT LISPSUPPORT NETWORKLOGINFO NETWORKOSTYPES PHONELISTFILES                             PRINTSERVICE TEDITSUPPORT USERGREETFILES LOCALPATCHDIRECTORY                             CHAT.HOSTINFO EMPRESS#SIDES NFS:*USE-VOLUME-MAP*)             DO (UNMARKASCHANGED VAR 'VARS])(SetDirectories
  [LAMBDA (ReleaseHostName LispusersUpdatesHostName LibraryUpdatesHostName FontHostName ReleaseName 
                 Reset)                                  (* ; "Edited 11-Nov-98 21:57 by rmk:")
                                                             (* ; 
                                                           "Edited 20-Feb-98 12:00 by kaplan")
                                                             (* ; 
                                                           "Edited 12-Feb-93 08:35 by kaplan")
                                                             (* "N.H.Briggs" " 2-Nov-87 12:14")
                                                             (* bbb "29-Oct-87 17:15")
                                                             (* edited%: "11-Jun-87 12:32")
    (DECLARE (GLOBALVARS \INIT.Location \INIT.CurrentReleaseName \INIT.PendingReleaseName 
                        DIRECTORIES LISPUSERSDIRECTORIES MAKESYSNAME IRM.HOST&DIR 
                        LOOPSUSERSDIRECTORIES FONTDIRECTORIES DISPLAYFONTDIRECTORIES 
                        DISPLAYFONTEXTENSIONS INTERPRESSFONTDIRECTORIES WHEREIS.HASH 
                        XCL::*WHERE-IS-CASH-FILES* LOCALPATCHDIRECTORY))
    (PROG (NewLispUsersDirectories NewDirectories (Medley1.1VersionNumber 39424))

     (* ;; "determine the release name, we take the hint from the system when it's present.")

          (SETQ ReleaseName (L-CASE (OR ReleaseName MAKESYSNAME)
                                   T))
          (SETQ ReleaseHostName (L-CASE ReleaseHostName))
          (SETQ LispusersUpdatesHostName (L-CASE (OR LispusersUpdatesHostName ReleaseHostName)))
          (SETQ LibraryUpdatesHostName (L-CASE (OR LibraryUpdatesHostName ReleaseHostName)))
          (SETQ FontHostName (L-CASE (OR FontHostName ReleaseHostName)))

     (* ;; "set up the pointer to the Interlisp reference manual for use by HELPSYS and DINFO. This depends on the release name.")

          (SAVESET 'IRM.HOST&DIR (SELECTQ ReleaseName
                                     ((Medley Medley2.0 Medley2.1 Medley3.5) 
                                          (CONCAT (HostPrefix ReleaseHostName)
                                                 "Lisp>Lyric>LispUsers>IRM>"))
                                     NIL)
                 T)

     (* ;; 
   "setup pointer to whereis hash files, these differ by version and no pattern has emerged yet")

          (SAVESET 'WHEREIS.HASH (SELECTQ ReleaseName
                                     (Medley NIL)
                                     (Medley2.0 NIL)
                                     (Medley2.1 NIL)
                                     (Medley3.5 NIL)
                                     NIL)
                 T)

     (* ;; "This is really messy, the general intent is as follows: if the user is running the current release he wants release>library>new, release>library, lispusers, release>lispusers. If running a LispCore or forked LispCore release, put those directories first, then take the pending release <the one that LispCore is newer than...> If running neither of the above, (could be older or newer than current) try release>library>new, release>library>, release>lispusers, lispusers. This all relies on the theory that <lispusers> has only the new packages for the current release. Currently, sources are only maintained on Eris, so the release>sources is always pointed there. This may change sometime. ")

     (* ;; "")

     (* ;; "8603 Things seemed to have settled down, we have the <lispusers>releasename> directories created and the procedures worked out. It is now not necessary to know if the user is running the %"current%" release in order to get the directories correct.")

     (* ;; "added Lispcore>Internal>Library per request from Masinter")

     (* ;; "")

          [SELECTQ ReleaseName
              (Medley2.0 (PUSH NewLispUsersDirectories "{dsk}/project/medley2.0/library/" 
                                "{dsk}/project/medley2.0/lispusers/"))
              (Medley2.1 (PUSH NewLispUsersDirectories "{dsk}/project/medley2.1/library/" 
                                "{dsk}/project/medley2.1/lispusers/" 
                                "{dsk}/project/medley2.1/sources/"))
              (Medley3.5 (PUSH NewLispUsersDirectories "{dsk}/project/medley3.5/library/" 
                                "{dsk}/project/medley3.5/lispusers/" 
                                "{dsk}/project/medley3.5/sources/"))
              (PROGN (PUSH NewLispUsersDirectories (CONCAT (HostPrefix ReleaseHostName)
                                                              "Lisp>" ReleaseName ">Library>")
                            (CONCAT (HostPrefix ReleaseHostName)
                                   "Lisp>" ReleaseName ">Internal>Library>")
                            (CONCAT (HostPrefix LispusersUpdatesHostName)
                                   "LispUsers>" ReleaseName ">")
                            (CONCAT (HostPrefix ReleaseHostName)
                                   "Lisp>" ReleaseName ">LispUsers>"))

                     (* ;; "Changed to <LispLibrary> from <Lisp>Library>New>")

                     (PUSH NewLispUsersDirectories (CONCAT (HostPrefix LibraryUpdatesHostName
                                                                      )
                                                              "LispLibrary>" ReleaseName ">"]
          [SETQ NewDirectories (APPEND NewDirectories (LDIFFERENCE NewLispUsersDirectories 
                                                             NewDirectories)
                                      (LIST (CONCAT (HostPrefix ReleaseHostName)
                                                   "Lisp>" ReleaseName ">Sources>"]
          (SAVESET 'LISPUSERSDIRECTORIES (APPEND NewLispUsersDirectories (AND (NOT Reset)
                                                                              (LDIFFERENCE 
                                                                                 LISPUSERSDIRECTORIES
                                                                                     
                                                                              NewLispUsersDirectories
                                                                                     )))
                 T)
          (SAVESET 'LOCALPATCHDIRECTORY (CONCAT (SELECTQ ReleaseName
                                                    (Medley (CONCAT (HostPrefix ReleaseHostName)
                                                                   "Lisp>" ReleaseName
                                                                   (IF (EQ (LISPVERSION)
                                                                               Medley1.1VersionNumber
                                                                               )
                                                                       THEN ""
                                                                     ELSE "1.15")))
                                                    (Medley2.0 "{dsk}<import>medley2.0")
                                                    (Medley2.1 "{dsk}<import>medley2.1")
                                                    (Medley3.5 "{dsk}<import>medley3.5")
                                                    (HELP))
                                               ">Patches>")
                 T)
          (SAVESET 'DIRECTORIES (APPEND NewDirectories (AND (NOT Reset)
                                                            (LDIFFERENCE DIRECTORIES NewDirectories))
                                       )
                 T)
          (IF (MEMB ReleaseName '(Medley Medley2.0 Medley2.1 Medley3.5))
              THEN (SAVESET 'XCL::*WHERE-IS-CASH-FILES* (MKLIST (FINDFILE 'SYSTEM.HASH T 
                                                                           DIRECTORIES))
                              T))
          (SAVESET 'LOOPSUSERSDIRECTORIES (LIST (PACKFILENAME 'HOST "{NB:PARC:Xerox}" 'BODY
                                                       (CONCAT "<Loops>" ReleaseName ">Users>")))
                 T)

     (* ;; "")

     (* ;; "the font directories depend on the release. We also check here whether the user is in bldg 35, in which case we add the Alto fonts. The press font widths must be on a random access device, and are sometimes kept on the local disk. If they aren't randaccessp then we put them on {dsk} if there's room, {core} if not.")

     (* ;; "")

          (SELECTQ ReleaseName
              ((Medley Medley2.0 Medley2.1 Medley3.5) 
                   (PROGN (SAVESET 'DISPLAYFONTDIRECTORIES (LIST (CONCAT (HostPrefix FontHostName
                                                                                )
                                                                        "Lisp>DisplayFonts>")
                                                                 (CONCAT (HostPrefix FontHostName
                                                                                )
                                                                        "AltoFonts>"))
                                 T)
                          (SAVESET 'DISPLAYFONTEXTENSIONS '(DISPLAYFONT STRIKE)
                                 T)
                          (SAVESET 'INTERPRESSFONTDIRECTORIES (LIST (CONCAT (HostPrefix 
                                                                                   FontHostName)
                                                                           "Lisp>IPFonts>"))
                                 T)))
              (PROGN (SAVESET 'DISPLAYFONTDIRECTORIES (UNION (LIST (CONCAT (HostPrefix 
                                                                                  FontHostName)
                                                                          "Lisp>Fonts>"))
                                                             (LIST (CONCAT (HostPrefix 
                                                                                  FontHostName)
                                                                          "AltoFonts>")
                                                                   (CONCAT (HostPrefix 
                                                                                  FontHostName)
                                                                          "AltoFonts>Original>")))
                            T)
                     (SAVESET 'DISPLAYFONTEXTENSIONS '(DISPLAYFONT STRIKE)
                            T)
                     (SAVESET 'INTERPRESSFONTDIRECTORIES (LIST (CONCAT (HostPrefix FontHostName)
                                                                      "Lisp>Fonts>"))
                            T)))
          (FOR var IN '(DIRECTORIES LISPUSERSDIRECTORIES IRM.HOST&DIR LOOPSUSERSDIRECTORIES 
                                      FONTDIRECTORIES DISPLAYFONTDIRECTORIES DISPLAYFONTEXTENSIONS 
                                      INTERPRESSFONTDIRECTORIES WHEREIS.HASH LOCALPATCHDIRECTORY 
                                      XCL::*WHERE-IS-CASH-FILES*) DO (UNMARKASCHANGED
                                                                          var
                                                                          'VARS])(LoadPatches
  [LAMBDA (DIRECTORY LDFLG AFTERDATE)                    (* ; "Edited  7-Feb-92 11:50 by bbb")

(* ;;; "Load all compiled files from the directory")

    (DECLARE (GLOBALVARS *COMPILED-EXTENSIONS*))
    (LET [(files (SORT (for EXT in *COMPILED-EXTENSIONS*
                          bind (AFTERIDATE _ (if AFTERDATE
                                                     then (OR (IDATE AFTERDATE)
                                                                  0)
                                                   else 0)) join (COLLECT-PATCH-FILES
                                                                          (DIRECTORYNAME DIRECTORY)
                                                                          EXT AFTERIDATE))
                       (FUNCTION (LAMBDA (X Y)
                                   (LESSP (CDR X)
                                          (CDR Y]            (* ; 
                                                           "files are sorted by increasing date")
         (for file in files do (SELECTQ LDFLG
                                               (HIDDEN       (* ; 
                                                       "Load the file, but don't put it on FILELST")
                                                       (LOAD? (CAR file)
                                                              T)
                                                       (SETQ FILELST (DREMOVE (FILENAMEFIELD
                                                                               (CAR file)
                                                                               'NAME)
                                                                            FILELST)))
                                               (LOAD? (CAR file)
                                                      LDFLG)))
         files])(COLLECT-PATCH-FILES
  [LAMBDA (DIRECTORY EXT AFTERIDATE)                     (* ; "Edited  7-Feb-92 11:49 by bbb")

    (* ;; "Generate list of files in DIRECTORY with extension EXT more recent than idate AFTERIDATE.  Return list of pairs (file . date).  Omits subdirectories.")

    (RESETLST
        (LET ((FILING.ENUMERATION.DEPTH 1)
              (NAKED-DIR (UNPACKFILENAME.STRING DIRECTORY 'DIRECTORY))
              FILE DATE)
             (bind [GEN _ (\GENERATEFILES (CONCAT DIRECTORY "*." EXT ";")
                                     '(ICREATIONDATE)
                                     '(SORT RESETLST] while (SETQ FILE (\GENERATENEXTFILE GEN))
                when (AND (STRING-EQUAL (UNPACKFILENAME.STRING FILE 'DIRECTORY)
                                     NAKED-DIR)
                              (> (SETQ DATE (\GENERATEFILEINFO GEN 'ICREATIONDATE))
                                 AFTERIDATE)) collect (CONS FILE DATE))))])(INTERLISPMODE
  [LAMBDA (OLD?)                                         (* N.H.Briggs " 2-Feb-88 14:26")
    (PROCESSPROP 'EXEC 'PROFILE (XCL:COPY-PROFILE (if OLD?
                                                      then "OLD-INTERLISP-T"
                                                    else "INTERLISP")))
    (XCL:SET-DEFAULT-EXEC-TYPE (if OLD?
                                   then "OLD-INTERLISP-T"
                                 else "INTERLISP"))
    (SETQ *DEFAULT-MAKEFILE-ENVIRONMENT* (LIST :READTABLE (if OLD?
                                                              then "OLD-INTERLISP-FILE"
                                                            else "INTERLISP")
                                               :PACKAGE "INTERLISP"])(FILE-SERVER-UP-P
  [LAMBDA (FILE-SERVER-NAME)                           (* ; "Edited 12-Oct-89 22:24 by Burwell")
    (PROG ([SERVER-TYPE (COND
                           ((STRPOS ":" (L-CASE FILE-SERVER-NAME))
                            'XNS)
                           ((STRPOS "/n" (L-CASE FILE-SERVER-NAME))
                            'NFS)
                           (T 'IFS]
           (PROCESS-RESULT (CONS))
           (PROCESS-HANDLE))
          (if (NULL FILE-SERVER-NAME)
              then (RETURN NIL))
          (SETQ PROCESS-HANDLE (ADD.PROCESS `(COND
                                                ((DIRECTORYNAMEP ,(SELECTQ SERVER-TYPE
                                                                      (XNS "DESKTOPS")
                                                                      (IFS "SYSTEM")
                                                                      (NFS (CONCAT "{" 
                                                                                  FILE-SERVER-NAME 
                                                                                  "}"))
                                                                      NIL)
                                                        ,FILE-SERVER-NAME)
                                                 (RPLACA ,(KWOTE PROCESS-RESULT)
                                                        T)))
                                      'NAME "file-server-up-p"))
          (DISMISS 500)
          (forDuration 60 timerUnits 'SECONDS until (CAR PROCESS-RESULT)
             do (DISMISS 500) finally (DEL.PROCESS PROCESS-HANDLE))
          (RETURN (CAR PROCESS-RESULT])(HostPrefix
  [LAMBDA (HostName)                                     (* ; "Edited 30-Jan-92 16:25 by bbb")
    (if (STRPOS "/n" (L-CASE HostName))
        then (CONCAT "{" HostName "}<" (SUBSTRING HostName 1 (DIFFERENCE (NCHARS HostName)
                                                                        2))
                        ">")
      elseif (OR (STRPOS "nfs}" (L-CASE HostName))
                     (STRPOS "dsk}" (L-CASE HostName)))
        then (CONCAT HostName)
      else (CONCAT "{" HostName "}<"]))(DEFINEQ(SUNOSNAME
  [LAMBDA NIL                                            (* ; "Edited  7-Dec-94 13:44 by rmk:")

    (* ;; "Returns name of curren SunOS version")

    (SELCHARQ (CHCON1 (UNIX-GETENV "OSVERSION"))
         (4 'SUNOS)
         (5 'SOLARIS)
         (HELP "UNKNOWN SUN OSVERSION" (UNIX-GETENV "OSVERFSION"]))(DEFMACRO WITHOUT.PAGEHOLD (WINDOW &BODY FORMS)   `(RESETLST        (LET* ((TTYWINDOW ,WINDOW)               (ORIGINAL.PAGEFULLFN (WINDOWPROP TTYWINDOW 'PAGEFULLFN))               (NEW.PAGEFULLFN (FUNCTION NILL)))              (RESETSAVE (WINDOWPROP TTYWINDOW 'PAGEFULLFN NEW.PAGEFULLFN)                     (LIST [FUNCTION (LAMBDA (TTYWINDOW NEW.PAGEFULLFN ORIGINAL.PAGEFULLFN)                                       (COND                                          ((EQ (WINDOWPROP TTYWINDOW 'PAGEFULLFN)                                               NEW.PAGEFULLFN)                                           (WINDOWPROP TTYWINDOW 'PAGEFULLFN ORIGINAL.PAGEFULLFN]                           TTYWINDOW NEW.PAGEFULLFN ORIGINAL.PAGEFULLFN)))        ,@FORMS))(* ;; "Initially set LOCALPATCHDIRECTORY to NIL to avoid loading patches if no servers are up.")(RPAQQ LOCALPATCHDIRECTORY NIL)(RPAQQ *USEOLDFONTDIRECTORIES* NIL)(RPAQ? UNIXMAIL.DOMAIN.NAME "parc.com")(RPAQ? INIT-NOGREET-FLAG NIL)(DECLARE%: DONTEVAL@LOAD DOCOPY (PARC-INIT))(DECLARE%: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDTOVAR NLAMA )(ADDTOVAR NLAML )(ADDTOVAR LAMA ))(PUTPROPS PARC-INIT COPYRIGHT ("Xerox Corporation" 1986 1987 1988 1989 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999 2002))(DECLARE%: DONTCOPY  (FILEMAP (NIL (1800 40555 (PARC-INIT 1810 . 5479) (FindSite 5481 . 8296) (FindInitHost 8298 . 10968) (ParcInit 10970 . 22993) (SetDirectories 22995 . 34548) (LoadPatches 34550 . 36498) (COLLECT-PATCH-FILES 36500 . 37477) (INTERLISPMODE 37479 . 38292) (FILE-SERVER-UP-P 38294 . 40000) (HostPrefix 40002 . 40553)) (40556 40900 (SUNOSNAME 40566 . 40898)))))STOP