;; double operation arithmetic tests for edge conditions
;; March 29, 1988 by Masinter 

(do-test-group ("Two Arg arithmetic opcodes"
             :before (test-defun and-eq-frob (frob test)
                        (and (eq frob 'frob) test)))
(do-test
 "Arithmetic edge condition tests "
 (macrolet
  ((check (op)
          `(or (null (setq val (pop arg)))
               (and-eq-frob 'frob (eql (,op arg1 arg2) val))
               (warn "(~A ~S ~S) is ~S and not ~S" ',op arg1 arg2 (,op arg1 arg2) val))))
  (every
   #'(lambda (arg)
            (let ((arg1 (pop arg))
                  (arg2 (pop arg))
                  (val nil))
                 (and (check +)
                      (check -)
                      (check *)
                      (check /)
                      (check il:iplus)
                      (check il:idifference)
                      (check il:itimes)
                      (check il:iquotient)
                      (check il:quotient)
                      (check logior)
                      (check logand)
                      (check logxor)
                      (check ash)
                      (check il:igreaterp)
                      (check >)
                      (check il:fgreaterp)
                      (check =)
                      (check eql))))
   (prog1
    '((0 0 0 0 0 nil 0 0 0 nil nil 0 0 0 0 nil nil nil t t)
      (0 1 1 -1 0 0 1 -1 0 0 0 1 0 1 0 nil nil nil nil nil)
      (0 -1 -1 1 0 0 -1 1 0 0 0 -1 0 -1 0 t t t nil nil)
      (0 1.0 1.0 -1.0 0.0 0.0 1 -1 0 0 0.0 1 0 1 0 nil nil nil nil nil)
      (0 65535 65535 -65535 0 0 65535 -65535 0 0 0 65535 0 65535 nil 
         nil nil nil nil nil)
      (0 -65536 -65536 65536 0 0 -65536 65536 0 0 0 -65536 0 -65536 0 t 
         t t nil nil)
      (0 65536 65536 -65536 0 0 65536 -65536 0 0 0 65536 0 65536 nil 
         nil nil nil nil nil)
      (0 -65537 -65537 65537 0 0 -65537 65537 0 0 0 -65537 0 -65537 0 t 
         t t nil nil)
      (0 2147483648 2147483648 -2147483648 0 0 2147483648 -2147483648 0 
         0 0 2147483648 0 2147483648 nil nil nil nil nil nil)
      (1 0 1 1 0 nil 1 1 0 nil nil 1 0 1 1 t t t nil nil)
      (1 1 2 0 1 1 2 0 1 1 1 1 1 0 2 nil nil nil t t)
      (1 -1 0 2 -1 -1 0 2 -1 -1 -1 -1 1 -2 0 t t t nil nil)
      (1 1.0 2.0 0.0 1.0 1.0 2 0 1 1 1.0 1 1 0 2 nil nil nil t nil)
      (1 65535 65536 -65534 65535 1/65535 65536 -65534 65535 0 0 65535 
         1 65534 nil nil nil nil nil nil)
      (1 -65536 -65535 65537 -65536 -1/65536 -65535 65537 -65536 0 0 
         -65535 0 -65535 1 t t t nil nil)
      (1 65536 65537 -65535 65536 1/65536 65537 -65535 65536 0 0 65537 
         0 65537 nil nil nil nil nil nil)
      (1 -65537 -65536 65538 -65537 -1/65537 -65536 65538 -65537 0 0 
         -65537 1 -65538 0 t t t nil nil)
      (1 2147483648 2147483649 -2147483647 2147483648 1/2147483648 
         2147483649 -2147483647 2147483648 0 0 2147483649 0 2147483649 
         nil nil nil nil nil nil)
      (-1 0 -1 -1 0 nil -1 -1 0 nil nil -1 0 -1 -1 nil nil nil nil nil)
      (-1 1 0 -2 -1 -1 0 -2 -1 -1 -1 -1 1 -2 -2 nil nil nil nil nil)
      (-1 -1 -2 0 1 1 -2 0 1 1 1 -1 -1 0 -1 nil nil nil t t)
      (-1 1.0 0.0 -2.0 -1.0 -1.0 0 -2 -1 -1 -1.0 -1 1 -2 -2 nil nil nil 
          nil nil)
      (-1 65535 65534 -65536 -65535 -1/65535 65534 -65536 -65535 0 0 -1 
          65535 -65536 nil nil nil nil nil nil)
      (-1 -65536 -65537 65535 65536 1/65536 -65537 65535 65536 0 0 -1 
          -65536 65535 -1 t t t nil nil)
      (-1 65536 65535 -65537 -65536 -1/65536 65535 -65537 -65536 0 0 -1 
          65536 -65537 nil nil nil nil nil nil)
      (-1 -65537 -65538 65536 65537 1/65537 -65538 65536 65537 0 0 -1 
          -65537 65536 -1 t t t nil nil)
      (-1 2147483648 2147483647 -2147483649 -2147483648 -1/2147483648 
          2147483647 -2147483649 -2147483648 0 0 -1 2147483648 
          -2147483649 nil nil nil nil nil nil)
      (1.0 0 1.0 1.0 0.0 nil 1 1 0 nil nil 1 0 1 1.0 t t t nil nil)
      (1.0 1 2.0 0.0 1.0 1.0 2 0 1 1 1.0 1 1 0 2 nil nil nil t nil)
      (1.0 -1 0.0 2.0 -1.0 -1.0 0 2 -1 -1 -1.0 -1 1 -2 0 t t t nil nil)
      (1.0 1.0 2.0 0.0 1.0 1.0 2 0 1 1 1.0 1 1 0 2 nil nil nil t t)
      (1.0 65535 65536.0 -65534.0 65535.0 1.5259022E-5 65536 -65534 
           65535 0 1.5259022E-5 65535 1 65534 nil nil nil nil nil nil)
      (1.0 -65536 -65535.0 65537.0 -65536.0 -1.5258789E-5 -65535 65537 
           -65536 0 -1.5258789E-5 -65535 0 -65535 0 t t t nil nil)
      (1.0 65536 65537.0 -65535.0 65536.0 1.5258789E-5 65537 -65535 
           65536 0 1.5258789E-5 65537 0 65537 nil nil nil nil nil nil)
      (1.0 -65537 -65536.0 65538.0 -65537.0 -1.5258556E-5 -65536 65538 
           -65537 0 -1.5258556E-5 -65537 1 -65538 0 t t t nil nil)
      (1.0 2147483648 2.1474836E+9 -2.1474836E+9 2.1474836E+9 
           4.656613E-10 2147483649 -2147483647 2147483648 0 
           4.656613E-10 2147483649 0 2147483649 nil nil nil nil nil nil
           )
      (65535 0 65535 65535 0 nil 65535 65535 0 nil nil 65535 0 65535 
             65535 t t t nil nil)
      (65535 1 65536 65534 65535 65535 65536 65534 65535 65535 65535 
             65535 1 65534 131070 t t t nil nil)
      (65535 -1 65534 65536 -65535 -65535 65534 65536 -65535 -65535 
             -65535 -1 65535 -65536 32767 t t t nil nil)
      (65535 1.0 65536.0 65534.0 65535.0 65535.0 65536 65534 65535 
             65535 65535.0 65535 1 65534 131070 t t t nil nil)
      (65535 65535 131070 0 4294836225 1 131070 0 4294836225 1 1 65535 
             65535 0 nil nil nil nil t t)
      (65535 -65536 -1 131071 -4294901760 -65535/65536 -1 131071 
             -4294901760 0 0 -1 0 -1 65535 t t t nil nil)
      (65535 65536 131071 -1 4294901760 65535/65536 131071 -1 
             4294901760 0 0 131071 0 131071 nil nil nil nil nil nil)
      (65535 -65537 -2 131072 -4294967295 -65535/65537 -2 131072 
             -4294967295 0 0 -65537 65535 -131072 0 t t t nil nil)
      (65535 2147483648 2147549183 -2147418113 140735340871680 
             65535/2147483648 2147549183 -2147418113 140735340871680 0 
             0 2147549183 0 2147549183 nil nil nil nil nil nil)
      (-65536 0 -65536 -65536 0 nil -65536 -65536 0 nil nil -65536 0 
             -65536 -65536 nil nil nil nil nil)
      (-65536 1 -65535 -65537 -65536 -65536 -65535 -65537 -65536 -65536 
             -65536 -65535 0 -65535 -131072 nil nil nil nil nil)
      (-65536 -1 -65537 -65535 65536 65536 -65537 -65535 65536 65536 
             65536 -1 -65536 65535 -32768 nil nil nil nil nil)
      (-65536 1.0 -65535.0 -65537.0 -65536.0 -65536.0 -65535 -65537 
             -65536 -65536 -65536.0 -65535 0 -65535 -131072 nil nil nil 
             nil nil)
      (-65536 65535 -1 -131071 -4294901760 -65536/65535 -1 -131071 
             -4294901760 -1 -1 -1 0 -1 nil nil nil nil nil nil)
      (-65536 -65536 -131072 0 4294967296 1 -131072 0 4294967296 1 1 
             -65536 -65536 0 -1 nil nil nil t t)
      (-65536 65536 0 -131072 -4294967296 -1 0 -131072 -4294967296 -1 
             -1 -65536 65536 -131072 nil nil nil nil nil nil)
      (-65536 -65537 -131073 1 4295032832 65536/65537 -131073 1 
             4295032832 0 0 -1 -131072 131071 -1 t t t nil nil)
      (-65536 2147483648 2147418112 -2147549184 -140737488355328 
             -1/32768 2147418112 -2147549184 -140737488355328 0 0 
             -65536 2147483648 -2147549184 nil nil nil nil nil nil)
      (65536 0 65536 65536 0 nil 65536 65536 0 nil nil 65536 0 65536 
             65536 t t t nil nil)
      (65536 1 65537 65535 65536 65536 65537 65535 65536 65536 65536 
             65537 0 65537 131072 t t t nil nil)
      (65536 -1 65535 65537 -65536 -65536 65535 65537 -65536 -65536 
             -65536 -1 65536 -65537 32768 t t t nil nil)
      (65536 1.0 65537.0 65535.0 65536.0 65536.0 65537 65535 65536 
             65536 65536.0 65537 0 65537 131072 t t t nil nil)
      (65536 65535 131071 1 4294901760 65536/65535 131071 1 4294901760 
             1 1 131071 0 131071 nil t t t nil nil)
      (65536 -65536 0 131072 -4294967296 -1 0 131072 -4294967296 -1 -1 
             -65536 65536 -131072 0 t t t nil nil)
      (65536 65536 131072 0 4294967296 1 131072 0 4294967296 1 1 65536 
             65536 0 nil nil nil nil t t)
      (65536 -65537 -1 131073 -4295032832 -65536/65537 -1 131073 
             -4295032832 0 0 -1 0 -1 0 t t t nil nil)
      (65536 2147483648 2147549184 -2147418112 140737488355328 1/32768 
             2147549184 -2147418112 140737488355328 0 0 2147549184 0 
             2147549184 nil nil nil nil nil nil)
      (-65537 0 -65537 -65537 0 nil -65537 -65537 0 nil nil -65537 0 
             -65537 -65537 nil nil nil nil nil)
      (-65537 1 -65536 -65538 -65537 -65537 -65536 -65538 -65537 -65537 
             -65537 -65537 1 -65538 -131074 nil nil nil nil nil)
      (-65537 -1 -65538 -65536 65537 65537 -65538 -65536 65537 65537 
             65537 -1 -65537 65536 -32769 nil nil nil nil nil)
      (-65537 1.0 -65536.0 -65538.0 -65537.0 -65537.0 -65536 -65538 
             -65537 -65537 -65537.0 -65537 1 -65538 -131074 nil nil nil 
             nil nil)
      (-65537 65535 -2 -131072 -4294967295 -65537/65535 -2 -131072 
             -4294967295 -1 -1 -65537 65535 -131072 nil nil nil nil nil 
             nil)
      (-65537 -65536 -131073 -1 4295032832 65537/65536 -131073 -1 
             4295032832 1 1 -1 -131072 131071 -1 nil nil nil nil nil)
      (-65537 65536 -1 -131073 -4295032832 -65537/65536 -1 -131073 
             -4295032832 -1 -1 -1 0 -1 nil nil nil nil nil nil)
      (-65537 -65537 -131074 0 4295098369 1 -131074 0 4295098369 1 1 
             -65537 -65537 0 -1 nil nil nil t t)
      (-65537 2147483648 2147418111 -2147549185 -140739635838976 
             -65537/2147483648 2147418111 -2147549185 -140739635838976 
             0 0 -65537 2147483648 -2147549185 nil nil nil nil nil nil)
      (2147483648 0 2147483648 2147483648 0 nil 2147483648 2147483648 0 
             nil nil 2147483648 0 2147483648 2147483648 t t t nil nil)
      (2147483648 1 2147483649 2147483647 2147483648 2147483648 
             2147483649 2147483647 2147483648 2147483648 2147483648 
             2147483649 0 2147483649 4294967296 t t t nil nil)
      (2147483648 -1 2147483647 2147483649 -2147483648 -2147483648 
             2147483647 2147483649 -2147483648 -2147483648 -2147483648 
             -1 2147483648 -2147483649 1073741824 t t t nil nil)
      (2147483648 1.0 2.1474836E+9 2.1474836E+9 2.1474836E+9 
             2.1474836E+9 2147483649 2147483647 2147483648 2147483648 
             2.1474836E+9 2147483649 0 2147483649 4294967296 t t t nil 
             nil)
      (2147483648 65535 2147549183 2147418113 140735340871680 
             2147483648/65535 2147549183 2147418113 140735340871680 
             32768 32768 2147549183 0 2147549183 nil t t t nil nil)
      (2147483648 -65536 2147418112 2147549184 -140737488355328 -32768 
             2147418112 2147549184 -140737488355328 -32768 -32768 
             -65536 2147483648 -2147549184 0 t t t nil nil)
      (2147483648 65536 2147549184 2147418112 140737488355328 32768 
             2147549184 2147418112 140737488355328 32768 32768 
             2147549184 0 2147549184 nil t t t nil nil)
      (2147483648 -65537 2147418111 2147549185 -140739635838976 
             -2147483648/65537 2147418111 2147549185 -140739635838976 
             -32767 -32767 -65537 2147483648 -2147549185 0 t t t nil 
             nil)
      (2147483648 2147483648 4294967296 0 4611686018427387904 1 
             4294967296 0 4611686018427387904 1 1 2147483648 2147483648 
             0 nil nil nil nil t t))
    '(let
      ((values '(0 1 -1 1.0 65535 -65536 65536 -65537 2147483648)))
      (mapcan
       #'(lambda (arg1)
                (mapcar #'(lambda (arg2)
                                 (list arg1 arg2 (+ arg1 arg2)
                                       (- arg1 arg2)
                                       (* arg1 arg2)
                                       (unless (= arg2 0)
                                              (/ arg1 arg2))
                                       (il:iplus arg1 arg2)
                                       (il:idifference arg1 arg2)
                                       (il:itimes arg1 arg2)
                                       (unless (= arg2 0)
                                              (il:iquotient arg1 arg2))
                                       (unless (= arg2 0)
                                              (il:quotient arg1 arg2))
                                       (logior arg1 arg2)
                                       (logand arg1 arg2)
                                       (logxor arg1 arg2)
                                       (unless (> arg2 64)
                                              (ash arg1 arg2))
                                       (il:igreaterp arg1 arg2)
                                       (> arg1 arg2)
                                       (il:fgreaterp arg1 arg2)
                                       (= arg1 arg2)
                                       (eql arg1 arg2))) values)) 
       values))))))
)
STOP
        GACHA          ? 1(DEFAULTFONT 1 (GACHA 10) (GACHA 8) (TERMINAL 8))            <             2ì      3C zº