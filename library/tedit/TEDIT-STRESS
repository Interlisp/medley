(DEFINE-FILE-INFO PACKAGE "INTERLISP" READTABLE "INTERLISP" BASE 10)

(FILECREATED " 4-Jun-2025 14:31:45" {WMEDLEY}<library>tedit>TEDIT-STRESS.;117 31118  

      :EDIT-BY rmk

      :CHANGES-TO (MACROS STRESS)

      :PREVIOUS-DATE " 4-Jun-2025 09:21:42" {WMEDLEY}<library>tedit>TEDIT-STRESS.;116)


(PRETTYCOMPRINT TEDIT-STRESSCOMS)

(RPAQQ TEDIT-STRESSCOMS
       (                                                     (* ; "Preload typical image objects")
        (FNS STRESSHC STRESSRAND STRESSPUT STRESSOPEN STRESSREAD STRESSFORMAT STRESSDISPLAY 
             STRESSSCROLL STRESSDELETE STRESSDELETEWINDOW STRESSINSERT STRESSINSERTWINDOW STRESSGREP
             STRESSPEEK)
        (FNS EQTEXTSTREAM SYSOUTRING COPYTOCORE CHECKARRAYS)
        (INITVARS (CHECKARRAYS T))
        (FILES TEDIT-DEBUG)
        (DECLARE%: EVAL@COMPILE DONTCOPY (MACROS STRESS))))



(* ; "Preload typical image objects")

(DEFINEQ

(STRESSHC
  [LAMBDA (FILES NSYSOUTS REPS ERROR SEPARATEOUT PDF SYSOUTNAME SINGLESTEP)
                                                             (* ; "Edited  2-Jun-2025 21:27 by rmk")
                                                             (* ; "Edited 21-Oct-2024 00:26 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:33 by rmk")
                                                             (* ; "Edited 14-Mar-2024 15:15 by rmk")
                                                             (* ; "Edited 13-Mar-2024 00:23 by rmk")
    (DECLARE (SPECVARS SINGLESTEP))

    (* ;; "If all arguments are defaulted, runs through all TEDIT files in the current directory until it fails, doing SAVEVM before each file.  The HC files are made as {CORE}FOO.PS.")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (CL:UNLESS NSYSOUTS
        (SETQ NSYSOUTS 'SAVEVM))
    [SETQ SYSOUTNAME (PACKFILENAME 'VERSION NIL 'BODY (OR SYSOUTNAME (PACKFILENAME 'DIRECTORY 
                                                                            MEDLEYDIR 'NAME 
                                                                            "STRESSHC" 'EXTENSION
                                                                            'SYSOUT]
    (PRINTOUT T REPS " reps of " (LENGTH FILES)
           " files saving "
           (if (EQ NSYSOUTS 0)
               then "no sysouts"
             elseif (EQ NSYSOUTS 'SAVEVM)
               then " the virtual memory"
             else (PRINTOUT NIL NSYSOUTS " sysouts on " 3)
                  SYSOUTNAME)
           T)
    (PRINTOUT T "First file is " (CAR FILES)
           T T)
    (BKSYSBUF " ")
    (for R SYSOUTS (ITYPE _ (CL:IF PDF
                                'pdf
                                'ps))
         (N _ 0) from 1 to REPS do (PRINTOUT T "Rep " R T)
                                   (if (EQ NSYSOUTS 'SAVEVM)
                                       then (SAVEVM)
                                     else (SETQ SYSOUTS (SYSOUTRING NSYSOUTS SYSOUTNAME SYSOUTS)))
                                   [for F TSTREAM HCFILE in FILES unless (DIRECTORYNAMEP F)
                                      do (PROMPTPRINT F)
                                         (SETQ HCFILE (CL:IF SEPARATEOUT
                                                          (OUTFILEP (PACKFILENAME 'EXTENSION ITYPE
                                                                           'VERSION 1 'BODY F))
                                                          (CL:IF PDF
                                                              "{CORE}FOO.PDF;1"
                                                              "{CORE}FOO.PS;1")))
                                         [STRESS (NOT ERROR)
                                                (SETQ TSTREAM (OPENTEXTSTREAM F))
                                                (CHECKARRAYS 'AFTEROPEN)
                                                (TEDIT.FORMAT.HARDCOPY TSTREAM HCFILE T NIL NIL NIL
                                                       (CL:IF PDF
                                                           'PDF
                                                           'POSTSCRIPT)]
                                         (CL:WHEN SINGLESTEP
                                             (\TEDIT.THELP (CONCAT "Just hardcopied " F " to " HCFILE
                                                                  )))]
                                   (PRINTOUT T "  Hardcopied " N " files without failure" T)
       finally (RETURN (LIST R N])

(STRESSRAND
  [LAMBDA (FILES REPS ERROR PROBESPERFILE)                   (* ; "Edited  2-Jun-2025 21:27 by rmk")
                                                             (* ; "Edited 31-May-2025 09:10 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:33 by rmk")
                                                             (* ; "Edited 12-Mar-2024 09:47 by rmk")

    (* ;; "Opens, fetches random characters")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (CL:UNLESS PROBESPERFILE (SETQ PROBESPERFILE 100))
    (BKSYSBUF " ")
    (PRINTOUT T REPS " reps of " (LENGTH FILES)
           " files with " PROBESPERFILE " probes per file" T)
    (for R (N _ 0) from 1 to REPS
       do (PRINTOUT T R " ")
          [for F TSTREAM in FILES unless (DIRECTORYNAMEP F)
             do (STRESS (NOT ERROR)
                       (SETQ TSTREAM (OPENTEXTSTREAM F))
                       (CHECKARRAYS 'AFTEROPEN)
                       (for I (LEN _ (TEDIT.NCHARS TSTREAM)) from 1 to PROBESPERFILE
                          do (TEDIT.NTHCHARCODE TSTREAM (RAND 1 LEN]
       finally (RETURN (LIST R N])

(STRESSPUT
  [LAMBDA (FILES REPS NOERROR CHECKEQUIV STOP)               (* ; "Edited  2-Jun-2025 21:28 by rmk")
                                                             (* ; "Edited 31-May-2025 09:10 by rmk")
                                                             (* ; "Edited 21-Oct-2024 00:26 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:34 by rmk")
                                                             (* ; "Edited 12-Mar-2024 09:48 by rmk")

    (* ;; "Opens, puts, reopens and tests for equivalence")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (BKSYSBUF " ")
    (PRINTOUT T REPS " reps of " (LENGTH FILES)
           " files" T)
    (for R (N _ 0) from 1 to REPS
       do (PRINTOUT T R " ")
          (for F TSTREAM TSP in FILES unless (DIRECTORYNAMEP F)
             do (STRESS NOERROR (SETQ TSTREAM (OPENTEXTSTREAM F))
                       (CHECKARRAYS 'AFTEROPEN)
                       (TEDIT.PUT TSTREAM "{CORE}FOO.TEDIT;1")
                       (SETQ TSP (OPENTEXTSTREAM "{CORE}FOO.TEDIT;1"))
                       (CL:WHEN (AND CHECKEQUIV (NOT (EQTEXTSTREAM TSTREAM TSP STOP)))
                              (\TEDIT.THELP "Get of put not equivalent" F))
                       (CLOSEF TSP))) finally (RETURN (LIST R N])

(STRESSOPEN
  [LAMBDA (FILES REPS NOERROR)                               (* ; "Edited  2-Jun-2025 21:28 by rmk")
                                                             (* ; "Edited 31-May-2025 09:12 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:34 by rmk")
                                                             (* ; "Edited 12-Mar-2024 09:48 by rmk")
                                                             (* ; "Edited 11-Mar-2024 09:15 by rmk")
    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (BKSYSBUF " ")
    (PRINTOUT T REPS " reps of " (LENGTH FILES)
           " files" T)
    (for R (N _ 0) from 1 to REPS do (PRINTOUT T R " ")
                                     [for F TSTREAM in FILES unless (DIRECTORYNAMEP F)
                                        do (STRESS NOERROR (SETQ TSTREAM (OPENTEXTSTREAM F]
       finally (RETURN (LIST R N])

(STRESSREAD
  [LAMBDA (FILES REPS NOERROR)                               (* ; "Edited  2-Jun-2025 21:28 by rmk")
                                                             (* ; "Edited 31-May-2025 09:13 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:34 by rmk")
                                                             (* ; "Edited 15-Mar-2024 15:19 by rmk")
                                                             (* ; "Edited 12-Mar-2024 09:48 by rmk")
                                                             (* ; "Edited 11-Mar-2024 09:13 by rmk")
    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (BKSYSBUF " ")
    (PRINTOUT T REPS " reps of " (LENGTH FILES)
           " files" T)
    (for R (N _ 0) from 1 to REPS do (PRINTOUT T R " ")
                                     [for F TSTREAM in FILES unless (DIRECTORYNAMEP F)
                                        do (STRESS NOERROR (SETQ TSTREAM (OPENTEXTSTREAM F))
                                                  (CHECKARRAYS 'AFTEROPEN)
                                                  (for I from 1 while (TEDIT.NTHCHARCODE TSTREAM I]
       finally (RETURN (LIST (SUB1 R)
                             N])

(STRESSFORMAT
  [LAMBDA (FILES REPS NOERROR)                               (* ; "Edited  2-Jun-2025 21:28 by rmk")
                                                             (* ; "Edited 31-May-2025 09:19 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:34 by rmk")
                                                             (* ; "Edited 15-Mar-2024 15:19 by rmk")
                                                             (* ; "Edited 12-Mar-2024 09:48 by rmk")
                                                             (* ; "Edited 11-Mar-2024 09:13 by rmk")

    (* ;; "Calls FORMATLINE from beginning to end of each file")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (BKSYSBUF " ")
    (PRINTOUT T REPS " reps of " (LENGTH FILES)
           " files" T)
    (for R (N _ 0) from 1 to REPS
       do (PRINTOUT T R " ")
          [for F TSTREAM TEXTOBJ in FILES unless (DIRECTORYNAMEP F)
             do (SETQ TSTREAM (OPENTEXTSTREAM F))
                (CHECKARRAYS 'AFTEROPEN)
                (SETQ TEXTOBJ (TEXTOBJ TSTREAM))
                (STRESS NOERROR (bind LINE (NCHARS _ (TEDIT.NCHARS TSTREAM))
                                      (CHNO _ 1) while (ILESSP CHNO NCHARS)
                                   do (CHECKARRAYS 'BEFORE)
                                      (SETQ LINE (\TEDIT.FORMATLINE TSTREAM CHNO))
                                      (CHECKARRAYS 'AFTER)
                                      (\TLVALIDATE (GETTOBJ TEXTOBJ THISLINE)
                                             LINE)
                                      (SETQ CHNO (GETLD LINE LCHARLIM]
       finally (RETURN (LIST (SUB1 R)
                             N])

(STRESSDISPLAY
  [LAMBDA (FILES REPS NOERROR)                               (* ; "Edited  2-Jun-2025 21:29 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:34 by rmk")
                                                             (* ; "Edited 15-Mar-2024 15:19 by rmk")
                                                             (* ; "Edited 12-Mar-2024 09:48 by rmk")
                                                             (* ; "Edited 11-Mar-2024 09:13 by rmk")

    (* ;; "Creates a single empty window, gets each file into that window without a process, and then displays every line there")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (BKSYSBUF " ")
    (PRINTOUT T REPS " reps of " (LENGTH FILES)
           " files" T)
    (for R [WINDOW _ (CREATEW '(600 800 800 150]
         (N _ 0) from 1 to REPS
       do (PRINTOUT T R " ")
          (for F TSTREAM TEXTOBJ in FILES unless (DIRECTORYNAMEP F)
             do                                              (* ; "No process")
                (STRESS NOERROR (WINDOWPROP WINDOW 'TITLE (CONCAT "Fetching " F))
                       [SETQ TSTREAM (OPENTEXTSTREAM F WINDOW '(READONLY T LEAVETTY T]
                       (CHECKARRAYS 'AFTEROPEN)
                       (SETQ TEXTOBJ (TEXTOBJ TSTREAM))
                       (bind LINE (NCHARS _ (TEDIT.NCHARS TSTREAM))
                             (CHNO _ 1) while (ILESSP CHNO NCHARS)
                          do (CHECKARRAYS 'BEFOREFORMAT)
                             (SETQ LINE (\TEDIT.FORMATLINE TSTREAM CHNO))
                             (\TLVALIDATE (GETTOBJ TEXTOBJ THISLINE)
                                    LINE)
                             (CHECKARRAYS 'BEFOREDISPLAY)
                             (\TEDIT.DISPLAYLINE TSTREAM LINE WINDOW)
                             (CHECKARRAYS 'AFTERDISPLAY)
                             (SETQ CHNO (GETLD LINE LCHARLIM)))
                       (CHECKARRAYS 'BEFOREDEACTIVATE)
                       (TEDIT.DEACTIVATE.WINDOW WINDOW)
                       (CHECKARRAYS 'AFTERDEACTIVATE)
                       (CLEARW WINDOW))) finally (RETURN (LIST (SUB1 R)
                                                               N])

(STRESSSCROLL
  [LAMBDA (FILES NSCROLLS REPS NOERROR)                      (* ; "Edited  2-Jun-2025 21:29 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:34 by rmk")
                                                             (* ; "Edited 15-Mar-2024 15:19 by rmk")
                                                             (* ; "Edited 12-Mar-2024 09:48 by rmk")
                                                             (* ; "Edited 11-Mar-2024 09:13 by rmk")

    (* ;; "Creates a single empty window, gets each file into that window without a process, and then does NSCROLLS random scrolls before moving on to the next file.")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS NSCROLLS (SETQ NSCROLLS 10))
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (BKSYSBUF " ")
    (PRINTOUT T "STRESS SCROLL: " REPS " reps randomly scrolling " NSCROLLS " times in " (LENGTH
                                                                                          FILES)
           " files" T)
    (for R [WINDOW _ (CREATEW '(600 500 750 400]
         (N _ 0) from 1 to REPS
       do (PRINTOUT T R " ")
          (for F TSTREAM TEXTOBJ LEN in FILES unless (DIRECTORYNAMEP F)
             do                                              (* ; "No process")
                (WINDOWPROP WINDOW 'TITLE (CONCAT "Fetching " F))
                [STRESS NOERROR [SETQ TSTREAM (OPENTEXTSTREAM F WINDOW '(READONLY T LEAVETTY T]
                       (CHECKARRAYS 'AFTEROPEN)
                       (SETQ TEXTOBJ (TEXTOBJ TSTREAM))
                       (SETQ LEN (TEDIT.NCHARS TSTREAM))
                       (for I from 1 to NSCROLLS do (CHECKARRAYS 'BEFORE)
                                                    (TEDIT.SETSEL TSTREAM (RAND 1 LEN)
                                                           1)
                                                    (TEDIT.NORMALIZECARET TSTREAM NIL T)
                                                    (CHECKARRAYS 'AFTER]
                (TEDIT.DEACTIVATE.WINDOW WINDOW)
                (CLEARW WINDOW)) finally (RETURN (LIST (SUB1 R)
                                                       N])

(STRESSDELETE
  [LAMBDA (FILES NTIMES REPS NOERROR)                        (* ; "Edited  4-Jun-2025 09:20 by rmk")
                                                             (* ; "Edited  2-Jun-2025 21:29 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:34 by rmk")
                                                             (* ; "Edited 15-Mar-2024 15:19 by rmk")
                                                             (* ; "Edited 12-Mar-2024 09:48 by rmk")
                                                             (* ; "Edited 11-Mar-2024 09:13 by rmk")

    (* ;; 
    "For each file does NDELETES random single-character deletes before moving on to the next file.")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS NTIMES (SETQ NTIMES 10))
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (BKSYSBUF " ")
    (PRINTOUT T "STRESS DELETE: " REPS " reps randomly deleting 1 character " NTIMES " times in "
           (LENGTH FILES)
           " files" T)
    (for R (N _ 0) from 1 to REPS
       do (PRINTOUT T R " ")
          (for F TSTREAM TEXTOBJ LEN in FILES unless (DIRECTORYNAMEP F)
             do                                              (* ; "No process")
                (STRESS NOERROR [SETQ TSTREAM (OPENTEXTSTREAM F NIL '(LEAVETTY T HISTORY OFF]
                       (CHECKARRAYS 'AFTEROPEN)
                       (SETQ TEXTOBJ (TEXTOBJ TSTREAM))
                       (SETQ LEN (TEDIT.NCHARS TSTREAM))
                       (for I from 1 to NTIMES do (CHECKARRAYS 'BEFORE)
                                                  (TEDIT.DELETE TSTREAM (RAND 1 LEN)
                                                         1)
                                                  (CHECKARRAYS 'AFTER)
                                                  (add LEN -1))
                       (CLOSEF? TSTREAM))) finally (RETURN (LIST (SUB1 R)
                                                                 N])

(STRESSDELETEWINDOW
  [LAMBDA (FILES NTIMES REPS NOERROR)                        (* ; "Edited  4-Jun-2025 09:19 by rmk")
                                                             (* ; "Edited  2-Jun-2025 22:35 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:34 by rmk")
                                                             (* ; "Edited 15-Mar-2024 15:19 by rmk")
                                                             (* ; "Edited 12-Mar-2024 09:48 by rmk")
                                                             (* ; "Edited 11-Mar-2024 09:13 by rmk")

    (* ;; "Creates a single empty window, gets each file into that window without a process, and then does NTIMES random 1-character deletions before moving on to the next file.")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS NTIMES (SETQ NTIMES 10))
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (BKSYSBUF " ")
    (PRINTOUT T "STRESS INSERT: " REPS " reps randomly inserting 3 characters " NTIMES " times in "
           (LENGTH FILES)
           " files" T)
    (for R [WINDOW _ (CREATEW '(550 800 750 150]
         (N _ 0) from 1 to REPS
       do (PRINTOUT T R " ")
          (for F TSTREAM TEXTOBJ LEN in FILES unless (DIRECTORYNAMEP F)
             do                                              (* ; "No process")
                (WINDOWPROP WINDOW 'TITLE (CONCAT "Fetching " F))
                (STRESS NOERROR [SETQ TSTREAM (OPENTEXTSTREAM F WINDOW '(LEAVETTY T HISTORY OFF]
                       (CHECKARRAYS 'AFTEROPEN)
                       (SETQ TEXTOBJ (TEXTOBJ TSTREAM))
                       (SETQ LEN (TEDIT.NCHARS TSTREAM))
                       (for I from 1 to NTIMES do (CHECKARRAYS 'BEFORE)
                                                  (TEDIT.DELETE TSTREAM (RAND 1 LEN))
                                                  (CHECKARRAYS 'AFTER)
                                                  (add LEN -1)))
                (PUTTEXTPROP TSTREAM 'DIRTY NIL)
                (TEDIT.DEACTIVATE.WINDOW WINDOW)
                (CLEARW WINDOW)) finally (RETURN (LIST (SUB1 R)
                                                       N])

(STRESSINSERT
  [LAMBDA (FILES NTIMES REPS NOERROR)                        (* ; "Edited  4-Jun-2025 09:18 by rmk")
                                                             (* ; "Edited  2-Jun-2025 22:34 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:34 by rmk")
                                                             (* ; "Edited 15-Mar-2024 15:19 by rmk")
                                                             (* ; "Edited 12-Mar-2024 09:48 by rmk")
                                                             (* ; "Edited 11-Mar-2024 09:13 by rmk")

    (* ;; "Does random inserts in the tstreams without a window or process")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS NTIMES (SETQ NTIMES 10))
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (BKSYSBUF " ")
    (PRINTOUT T "STRESS INSERT: " REPS " reps randomly inserting 3 characters " NTIMES " times in "
           (LENGTH FILES)
           " files" T)
    (for R (N _ 0) from 1 to REPS
       do (PRINTOUT T R " ")
          (for F TSTREAM TEXTOBJ LEN in FILES unless (DIRECTORYNAMEP F)
             do                                              (* ; "No process")
                (STRESS NOERROR [SETQ TSTREAM (OPENTEXTSTREAM F NIL '(LEAVETTY T HISTORY OFF]
                       (CHECKARRAYS 'AFTEROPEN)
                       (SETQ TEXTOBJ (TEXTOBJ TSTREAM))
                       (SETQ LEN (TEDIT.NCHARS TSTREAM))
                       (for I from 1 to NTIMES do (CHECKARRAYS 'BEFORE)
                                                  (TEDIT.INSERT TSTREAM "aaa" (RAND 1 LEN))
                                                  (CHECKARRAYS 'AFTER)
                                                  (add LEN 3))
                       (CLOSEF? TSTREAM))) finally (RETURN (LIST (SUB1 R)
                                                                 N])

(STRESSINSERTWINDOW
  [LAMBDA (FILES NTIMES REPS NOERROR)                        (* ; "Edited  2-Jun-2025 22:35 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:34 by rmk")
                                                             (* ; "Edited 15-Mar-2024 15:19 by rmk")
                                                             (* ; "Edited 12-Mar-2024 09:48 by rmk")
                                                             (* ; "Edited 11-Mar-2024 09:13 by rmk")

    (* ;; "Creates a single empty window, gets each file into that window without a process, and then does NTIMES random 3-character inserts before moving on to the next file.")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS NTIMES (SETQ NTIMES 10))
    (CL:UNLESS REPS (SETQ REPS MAX.SMALLP))
    (BKSYSBUF " ")
    (PRINTOUT T "STRESS INSERT: " REPS " reps randomly inserting 3 characters " NTIMES " times in "
           (LENGTH FILES)
           " files" T)
    (for R [WINDOW _ (CREATEW '(550 800 750 150]
         (N _ 0) from 1 to REPS
       do (PRINTOUT T R " ")
          (for F TSTREAM TEXTOBJ LEN in FILES unless (DIRECTORYNAMEP F)
             do                                              (* ; "No process")
                (WINDOWPROP WINDOW 'TITLE (CONCAT "Fetching " F))
                (STRESS NOERROR [SETQ TSTREAM (OPENTEXTSTREAM F WINDOW '(LEAVETTY T HISTORY OFF]
                       (CHECKARRAYS 'AFTEROPEN)
                       (SETQ TEXTOBJ (TEXTOBJ TSTREAM))
                       (SETQ LEN (TEDIT.NCHARS TSTREAM))
                       (for I from 1 to NTIMES do (CHECKARRAYS 'BEFORE)
                                                  (TEDIT.INSERT TSTREAM "aaa" (RAND 1 LEN))
                                                  (CHECKARRAYS 'AFTER)
                                                  (add LEN 3)))
                (PUTTEXTPROP TSTREAM 'DIRTY NIL)
                (TEDIT.DEACTIVATE.WINDOW WINDOW)
                (CLEARW WINDOW)) finally (RETURN (LIST (SUB1 R)
                                                       N])

(STRESSGREP
  [LAMBDA (FILES NOERROR TARGET)                             (* ; "Edited  2-Jun-2025 21:30 by rmk")
                                                             (* ; "Edited 17-Mar-2024 19:46 by rmk")

    (* ;; "GREP does forward bins and peekbins.  If it hits on something, it also runs the backfileptr function.  FOO appears in quite a few lispusers/ Tedit files.")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (CL:UNLESS TARGET (SETQ TARGET "FOO"))
    (FILESLOAD GREP)
    (for F in FILES unless (DIRECTEORYNAMEP F) unless (if NOERROR
                                                          then (NLSETQ (GREP TARGET F))
                                                        else (PROGN (GREP TARGET F))
                                                             T)
       do (PRINTOUT T T "Error for " (PACKFILENAME 'HOST NIL 'DIRECTORY NIL 'BODY F)
                 T])

(STRESSPEEK
  [LAMBDA (FILES ERROR)                                      (* ; "Edited  2-Jun-2025 21:30 by rmk")
                                                             (* ; "Edited 19-Mar-2024 21:33 by rmk")
    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (for F TSTREAM (N _ 0) in FILES unless (DIRECTORYNAMEP F)
       do (STRESS (NOT ERROR)
                 (SETQ TSTREAM (OPENTEXTSTREAM F))
                 (CHECKARRAYS 'AFTEROPEN)
                 (bind P while (SETQ P (PEEKCCODE TSTREAM T)) always (EQ P (BIN TSTREAM])
)
(DEFINEQ

(EQTEXTSTREAM
  [LAMBDA (TS1 TS2 STOP)                                     (* ; "Edited 21-Oct-2024 00:26 by rmk")
                                                             (* ; "Edited 11-Mar-2024 16:53 by rmk")
    (AND (IEQP (TEDIT.NCHARS TS1)
               (TEDIT.NCHARS TS2))
         (OR (for I C1 C2 from 1 to (TEDIT.NCHARS TS1) eachtime (SETQ C1 (TEDIT.NTHCHARCODE TS1 I))
                                                             (SETQ C2 (TEDIT.NTHCHARCODE TS2 I))
                unless (OR (EQ C1 C2)
                           (AND (EQ C1 10)
                                (EQ C2 13))
                           (AND (EQ C1 13)
                                (EQ C2 10))
                           (AND (IMAGEOBJP C1)
                                (IMAGEOBJP C2)
                                (EQUALALL C1 C2))) do (CL:WHEN STOP
                                                          (\TEDIT.THELP "Different characters: "
                                                                 (LIST I C1 C2)))
                                                      (RETURN NIL) finally (RETURN T])

(SYSOUTRING
  [LAMBDA (NSYSOUTS SYSOUTNAME SYSOUTS)                      (* ; "Edited 12-Mar-2024 17:52 by rmk")

    (* ;; "SYSOUTS is the list of names of sysouts that currently exist.")

    (DECLARE (USEDFREE SINGLESTEP))
    (CL:WHEN (IGREATERP NSYSOUTS 0)                          (* ; 
                                                      "Keep NSYSOUT sysouts with increasing versions")
        (CL:WHEN (IGEQ (LENGTH SYSOUTS)
                       NSYSOUTS)
            (DELFILE (pop SYSOUTS)))                         (* ; 
                                                  "Drop the firstr (oldest), new one goes at the end")
        (SETQ SYSOUTNAME (SYSOUT SYSOUTNAME))
        (CL:WHEN (LISTP SYSOUTNAME)                          (* ; "Restarting")
            (SETQ SINGLESTEP T))
        (NCONC1 SYSOUTS SYSOUTNAME))])

(COPYTOCORE
  [LAMBDA (FILES NORECLAIM)                                  (* ; "Edited  2-Jun-2025 21:30 by rmk")
                                                             (* ; "Edited 12-Mar-2024 22:45 by rmk")

    (* ;; "Copy FILES to {CORE}, defaulting to TEDIT files in connected directory")

    [SETQ FILES (OR (MKLIST FILES)
                    (FILDIR '*.TEDIT;]
    (PRINTOUT T "Copying " (LENGTH FILES)
           " files to {CORE} "
           (CL:IF NORECLAIM
               "without "
               "with ")
           "reclaiming" T)
    (for F in FILES collect (COPYFILE F (PACKFILENAME 'HOST 'CORE 'DIRECTORY NIL 'BODY F))
       finally (CL:UNLESS NORECLAIM (RECLAIM])

(CHECKARRAYS
  [LAMBDA (TAG)
    (DECLARE (SPECVARS TAG))                                 (* ; "Edited  2-Jun-2025 21:11 by rmk")

    (* ;; "TAG is visible as an argument in URAID")

    (CL:WHEN CHECKARRAYS
        (CL:WHEN (EQ CHECKARRAYS 'RECLAIM)
               (RECLAIM))
        (\PARSEARRAYSPACE))])
)

(RPAQ? CHECKARRAYS T)

(FILESLOAD TEDIT-DEBUG)
(DECLARE%: EVAL@COMPILE DONTCOPY 
(DECLARE%: EVAL@COMPILE 

(PUTPROPS STRESS MACRO ((NOERROR . FORMS)
                        (CHECKARRAYS 'BEFORESTRESS)
                        (if (if NOERROR
                                then (NLSETQ . FORMS)
                              else (PROGN . FORMS)
                                   T)
                            then (add N 1)
                          else (PRINTOUT T T "Error for " (PACKFILENAME 'HOST NIL 'DIRECTORY NIL
                                                                 'BODY F)
                                      T))
                        (CHECKARRAYS 'AFTERSTRESS)
                        (CLOSEF? TSTREAM)))
)
)
(DECLARE%: DONTCOPY
  (FILEMAP (NIL (925 27183 (STRESSHC 935 . 4745) (STRESSRAND 4747 . 6061) (STRESSPUT 6063 . 7544) (
STRESSOPEN 7546 . 8620) (STRESSREAD 8622 . 10033) (STRESSFORMAT 10035 . 11942) (STRESSDISPLAY 11944 . 
14388) (STRESSSCROLL 14390 . 16734) (STRESSDELETE 16736 . 18891) (STRESSDELETEWINDOW 18893 . 21255) (
STRESSINSERT 21257 . 23320) (STRESSINSERTWINDOW 23322 . 25578) (STRESSGREP 25580 . 26565) (STRESSPEEK 
26567 . 27181)) (27184 30307 (EQTEXTSTREAM 27194 . 28363) (SYSOUTRING 28365 . 29245) (COPYTOCORE 29247
 . 29976) (CHECKARRAYS 29978 . 30305)))))
STOP
