(DEFINE-FILE-INFO READTABLE "INTERLISP" PACKAGE "INTERLISP")(FILECREATED " 6-Feb-2021 15:19:48" {DSK}<home>larry>ilisp>medley>sources>SYNCLISPFILES.;2 7670         changes to%:  (FNS SYNCLISPFILES)      previous date%: " 5-Feb-2021 15:41:04" {DSK}<home>larry>ilisp>medley>sources>SYNCLISPFILES.;1)(PRETTYCOMPRINT SYNCLISPFILESCOMS)(RPAQQ SYNCLISPFILESCOMS ((FNS)                              (FNS SYNCLISPFILES NOPUPPATCH)))(DEFINEQ(SYNCLISPFILES  [LAMBDA (NOSYSLOAD)                                  (* ; "Edited  6-Feb-2021 15:16 by larry")                                                             (* ; "Edited  5-Feb-2021 15:40 by lmm")                                                             (* ;                                                            "Edited 23-Oct-2020 23:51 by rmk:")                                                             (* ;                                                            "Edited 20-Apr-2018 18:28 by rmk:")    (* ;; "This ensures that  files in the xlisp.sysout are as up-to-date as possible with respect to sources. Reload (compiled, if possible) files that correspond to symbolic files whose filedates are later than the filedate in the system. If you want a new compilation of a file that has not been modified to be included, then you must make a trivial update of the symbolic file and recompile it, to give it a new, later date.  This is because it is unsafe as a general default to load compiled files with dates later than the sysout, and the sysout doesn't record the dates of loaded compiled files, just their symbolic versions.")    (* ;; " Should be run while connected to MEDLEYDIR")    (LET ((SKIPFILES '(SYNCLISPFILES))          (SOURCEDIR (MEDLEYDIR "sources")))         (* ;;       "FASLOAD has to come first, unconditionally, to get the DFASL file dates converted properly.")         (PRINTOUT T T "Synchronizing Lisp sysout at " (DATE)                T)         (PRINTOUT T 5 (CDAR (GETP 'SYNCLISPFILES 'FILEDATES))                T 5 "created " (CAAR (GETP 'SYNCLISPFILES 'FILEDATES))                T T)         (* ;;       "FASLOAD has to come first, unconditionally, to get the DFASL file dates converted properly.")         (push SKIPFILES 'FASLOAD)         (LOAD (MEDLEYDIR "sources" "FASLOAD.DFASL")               (IF NOSYSLOAD                   THEN NIL                 ELSE 'SYSLOAD))         (push SKIPFILES 'ATBL)                          (* ;                                                    "Whole file can't be reloaded--smashes readtabl")         (LOADFNS '(\ATBLSET \MAPCHARTABLE RESETREADTABLE)                (MEDLEYDIR "sources" "ATBL.LCOM")                'SYSLOAD)         (LOADVARS '\KEYNAMES (MEDLEYDIR "sources" "LLKEY")                'SYSLOAD)                                    (* ; "Extended keynames for Mac/PC")         (push SKIPFILES 'LLKEY)                         (* ; "Loading whole file freezes")         (push SKIPFILES 'MAIKOLOADUPFNS)                (* ;                                                     "Can't reload even if compiled files are later")         (push SKIPFILES 'SUNFONT)                       (* ;                                                            "Old font organization, not relevant")         (for LF FF CFILE LOADEDDATE FILEDATE IFILEDATE NOCOMPILEDFILES CFILES (COUNT _ 0)            in (LDIFFERENCE SYSFILES SKIPFILES)            do [SETQ LOADEDDATE (CAAR (GETP LF 'FILEDATES]                                                              (* ;                                               "Date of symbolic file whose compile file was loaded")                  (CL:UNLESS LOADEDDATE                      (PRINTOUT T T LF                              " does not have a loaded filedate, probably not a Lisp file; skipped" T)                      (GO $$ITERATE))                  (SETQ FF (PACKFILENAME.STRING 'NAME LF 'BODY SOURCEDIR))                  (SETQ FILEDATE (FILEDATE FF))              (* ; "Date of current source file")                  (CL:UNLESS FILEDATE                      (PRINTOUT T LF " does not have a file-directory date, not updated" T)                      (GO $$ITERATE))                  (SETQ CFILES (for EXT in *COMPILED-EXTENSIONS*                                  when (SETQ CFILE (INFILEP (PACKFILENAME.STRING 'EXTENSION EXT                                                                       'BODY FF))) collect CFILE)                   )                  (SETQ CFILE (COND                                 [CFILES                                         (* ;;                                       "If more than one (LCOM, DFASL), pick the newest one.")                                        (for CF in CFILES                                           largest (IDATE (FILEDATE CF T]                                 (T (PRINTOUT T "Note: No compiled file for " LF T)                                    (push NOTCOMPILEDFILES LF)                                    FF)))                  (SETQ IFILEDATE (IDATE FILEDATE))                  (CL:UNLESS (IGREATERP IFILEDATE 0)                      (PRINTOUT T "Funny file date " FILEDATE " for " LF ", not updated" T)                      (GO $$ITERATE))                   (* ;; "Load the compiled file if the date of the symbolic file is later than the symbolic file-date in the sysout.  If an updated source and compiled file were copied from another directory, we update the FILEDATES property to point to the new location.  If the loaded and file dates are the same, then update the FILEDATES property to point to the possibly new path name and version even if we don't need to load.")                  (SETQ LOADEDDATE (IDATE LOADEDDATE))                  (if (IGREATERP IFILEDATE LOADEDDATE)                      then (add COUNT 1)                             (* ;; " FINALLY do the load")                            (LOAD CFILE (if NOSYSLOAD                                            then NIL                                          else 'SYSLOAD))                            (CL:WHEN [STREQUAL FILEDATE (CAAR (GETP LF 'FILEDATES]                                (* ;; "If copied, the compiled file may install the original location.  Not sure what happens with copied DFASLs")                                (RPLACD (CAR (GETP LF 'FILEDATES))                                       (INFILEP FF)))                    elseif (IEQP IFILEDATE LOADEDDATE)                      then (RPLACD (CAR (GETP LF 'FILEDATES))                                      (INFILEP FF)))            finally (PRINTOUT T T T COUNT " files loaded" T)                  (CL:WHEN NOCOMPILEDFILES (PRINTOUT T "Symbolic files loaded:  " .PPVTL                                                   NOCOMPILEDFILES T T)))         (NOPUPPATCH])(NOPUPPATCH  [LAMBDA NIL                                                (* ;                                                            "Edited 14-May-2018 12:22 by rmk:")    (* ;; "Fix it so pup stuff never gets run")    (SETQ \PROCESSES (DREMOVE (FIND.PROCESS '\PUPGATELISTENER)                            \PROCESSES))    (SETQ \FILEDEVICES (for F in \FILEDEVICES unless (STRPOS "LEAF" F) collect F))    (MOVD 'NILL '\CANONICALIZE.PUP.HOSTNAME]))(PUTPROPS SYNCLISPFILES COPYRIGHT (NONE))(DECLARE%: DONTCOPY  (FILEMAP (NIL (449 7605 (SYNCLISPFILES 459 . 7113) (NOPUPPATCH 7115 . 7603)))))STOP