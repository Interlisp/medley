
(defmacro with-hash-table-iterator ((name hash-table-form) &body body)
  (let ((iterator (gensym)))
    `(let ((,iterator (hash-table-iterator ,hash-table-form)))
      (declare (ignorable ,iterator))
      (macrolet ((,name () '(funcall ,iterator)))
	,@body))))

 (loop for k being the hash-keys in *h* using (hash-value v)
  do (format t "~a => ~a~%" k v))